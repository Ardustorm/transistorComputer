* D:\transistorComputer\CMOS\Test_Counter.asc
XX1 VDD CNT[0] CNT[1] CNT[2] CLK counter

* block symbol definitions
.subckt counter VDD CNT[0] CNT[1] CNT[2] CLK
XX1 NS[0] NS[1] NS[2] VDD CNT[0] CNT[1] CNT[2] CLK !Q[0] !Q[1] !Q[2] reg[3]
XX2 CNT[0] CNT[1] CNT[2] VDD NS[0] NS[1] NS[2] counter_ns
.ends counter

.subckt reg[3] D[0] D[1] D[2] VDD Q[0] Q[1] Q[2] CLK !Q[0] !Q[1] !Q[2]
XX2 D[1] VDD Q[1] CLK !Q[1] dff
XX1 D[0] VDD Q[0] CLK !Q[0] dff
XX3 D[2] VDD Q[2] CLK !Q[2] dff
.ends reg[3]

.subckt counter_ns PS[0] PS[1] PS[2] VDD NS[0] NS[1] NS[2]
XX4 N001 VDD NS[0] gate_delay params: Speed=1
XX5 N002 VDD NS[1] gate_delay params: Speed=1
XX6 N004 VDD NS[2] gate_delay params: Speed=1
XX2 PS[0] PS[1] N002 VDD gate_xor
XX3 N003 PS[2] N004 VDD gate_xor
XX7 PS[0] PS[1] N003 VDD gate_and
XX13 PS[0] VDD N001 gate_not_param params: Speed=10
.ends counter_ns

.subckt dff D VDD Q CLK !Q
XX1 CLK VDD N002 gate_not_param params: Speed=1
XX2 D VDD N004 gate_not_param params: Speed=100
XX6 N003 Q !Q VDD gate_nand_param params: Speed=100
XX5 N001 !Q Q VDD gate_nand_param params: Speed=100
XX3 D CLK N002 VDD N001 gate_nand3_param params: Speed=100
XX4 N002 CLK N004 VDD N003 gate_nand3_param params: Speed=100
.ic V(Q)=0
.ends dff

.subckt gate_delay A VDD OUT
M1 N001 A 0 0 myNMOS w=myNW L=myNL
M2 N001 A VDD VDD myPMOS W=myPW L=myPL
M3 Out N001 0 0 myNMOS w=myNW L=myNL
M4 Out N001 VDD VDD myPMOS W=myPW L=myPL
.inc Mod_W2017N.mod
.param myPW=2u*sqrt(Speed)
.param myPL=100u/sqrt(Speed)
.param myNW=.1u*sqrt(Speed)
.param myNL=500u/sqrt(Speed)
.param Speed=.1
.ends gate_delay

.subckt gate_xor A B Out VDD
M1 Out A N003 N003 RIT4007N7
M2 Out N002 P001 P001 RIT4007P7
M3 Out N001 P002 P002 RIT4007P7
M4 N003 N001 0 0 RIT4007N7
M5 N003 B 0 0 RIT4007N7
M6 Out N002 N003 N003 RIT4007N7
M7 P002 B VDD VDD RIT4007P7
M8 P001 A VDD VDD RIT4007P7
XX1 A VDD N001 gate_not
XX4 B VDD N002 gate_not
.inc CD4007.mod
.ends gate_xor

.subckt gate_and A B Out VDD
XX3 A B N001 VDD gate_nand
XX4 N001 VDD Out gate_not
.ends gate_and

.subckt gate_not_param A VDD !A
M1 !A A 0 0 myNMOS W=myNW L=myNL
M2 !A A VDD VDD myPMOS W=myPW L=myPL
.inc Mod_W2017N.mod
.param myPW=2u*sqrt(Speed)
.param myPL=100u/sqrt(Speed)
.param myNW=.6u*sqrt(Speed)
.param myNL=100u/sqrt(Speed)
.param Speed=1
.ends gate_not_param

.subckt gate_nand_param A B Out VDD
M1 Out A N001 N001 myNMOS W=myNW L=myNL
M2 Out A VDD VDD myPMOS W=myPW L=myPL
M3 Out B VDD VDD myPMOS W=myPW L=myPL
M4 N001 B 0 0 myNMOS W=myNW L=myNL
.inc Mod_W2017N.mod
.param myPW=2u*sqrt(Speed)
.param myPL=100u/sqrt(Speed)
.param myNW=.6u*sqrt(Speed)
.param myNL=100u/sqrt(Speed)
.param Speed=1
.ends gate_nand_param

.subckt gate_nand3_param A B C VDD Out
M1 Out A N001 N001 myNMOS W=myNW L=myNL
M4 Out A VDD VDD myPMOS W=myPW L=myPL
M5 Out B VDD VDD myPMOS W=myPW L=myPL
M2 N001 B P001 P001 myNMOS W=myNW L=myNL
M3 P001 C 0 0 myNMOS W=myNW L=myNL
M6 Out C VDD VDD myPMOS W=myPW L=myPL
.inc Mod_W2017N.mod
.param myPW=2u*sqrt(Speed)
.param myPL=100u/sqrt(Speed)
.param myNW=.9u*sqrt(Speed)
.param myNL=100u/sqrt(Speed)
.param Speed=1
.ends gate_nand3_param

.subckt gate_not A VDD !A
M1 !A A 0 0 RIT4007N7
M2 !A A VDD VDD RIT4007P7
.inc CD4007.mod
.ends gate_not

.subckt gate_nand A B Out VDD
M1 Out A N001 N001 RIT4007N7
M2 Out A VDD VDD RIT4007P7
M3 Out B VDD VDD RIT4007P7
M4 N001 B 0 0 RIT4007N7
.inc CD4007.mod
.ends gate_nand

.model NMOS NMOS
.model PMOS PMOS
.lib C:\Users\john\Documents\LTspiceXVII\lib\cmp\standard.mos
.tran 20m
.inc Test_input_DFF.txt
.backanno
.end
